<!DOCTYPE html>
<head>
    
    <title>Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    {% include 'header.html' %}
    <main id="app">
        <div id="content">Welcome â€” select a section from the navigation.</div>
    </main>

    <script>
    // Simple client-side router that fetches rendered template fragments
    async function loadPath(path, push=true) {
        try {
            const res = await fetch(path);
            if (!res.ok) {
                document.getElementById('content').innerHTML = '<p>Module not found.</p>';
                return;
            }
            const html = await res.text();
            // If the response is a full HTML document, inject only its <body> contents
            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const body = doc.querySelector('body');
                let contentHtml = body ? body.innerHTML : html;
                // Strip any header elements to avoid duplicating the global header/nav
                try {
                    const tmp = document.createElement('div');
                    tmp.innerHTML = contentHtml;
                    const headers = tmp.querySelectorAll('header');
                    headers.forEach(h => h.remove());
                    const mains = tmp.querySelectorAll('#main-nav');
                    mains.forEach(m => m.remove());
                    contentHtml = tmp.innerHTML;
                } catch (e) {
                    // ignore
                    // ignore
                }
                document.getElementById('content').innerHTML = contentHtml;
                
                // Re-execute scripts in the new content
                const scripts = document.getElementById('content').querySelectorAll('script');
                scripts.forEach(oldScript => {
                    const newScript = document.createElement('script');
                    Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                    newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });
            } catch (err) {
                document.getElementById('content').innerHTML = html;
            }
            if (push) history.pushState({path}, '', path);
        } catch (e) {
            document.getElementById('content').innerHTML = '<p>Error loading module.</p>';
        }
    }

    // Intercept nav clicks
    document.addEventListener('click', function(e) {
        const a = e.target.closest('a');
        if (!a) return;
        const href = a.getAttribute('href');
        if (!href) return;
        // Only intercept internal links (start with '/')
        if (href.startsWith('/')) {
            e.preventDefault();
            loadPath(href);
        }
    });

    // Handle back/forward
    window.addEventListener('popstate', function(e) {
        const path = location.pathname || '/';
        loadPath(path, false);
    });

    // On first load, load current path if not '/'
    (function(){
        const path = location.pathname || '/';
        if (path !== '/') loadPath(path, false);
    })();
    </script>
</body>